# --- Server Block 1: HTTP Redirect to HTTPS ---
server {
    # Listen on standard HTTP port 80
    listen 80;
    listen [::]:80;
    
    # Replace [YOUR_DOMAIN_NAME] with your actual domain name
    server_name [YOUR_DOMAIN_NAME];

    # Certbot-style permanent redirect to the HTTPS server block
    if ($host = [YOUR_DOMAIN_NAME]) {
        return 301 https://$host$request_uri;
    }
    # Optional: Catch-all block for safety
    return 404; 
}

# --- Server Block 2: Main HTTPS Application Server ---
server {
    # Listen on standard HTTPS port 443 with SSL
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    
    # Replace [YOUR_DOMAIN_NAME] with your actual domain name
    server_name [YOUR_DOMAIN_NAME];

    # --- SSL Certificate Paths (Set by Certbot) ---
    # These paths are standard if Certbot handled the certificate
    ssl_certificate /etc/letsencrypt/live/[YOUR_DOMAIN_NAME]/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/[YOUR_DOMAIN_NAME]/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # Max body size (e.g., for file uploads)
    client_max_body_size 10M;

    # --- Logging (New Feature) ---
    # Define dedicated access and error logs for this specific application
    access_log /var/log/nginx/[APP_NAME]_access.log;
    error_log /var/log/nginx/[APP_NAME]_error.log warn;

    # --- Static File Serving (New Feature) ---
    # Nginx serves static files (CSS, JS, images) directly for performance
    location /static/ {
        # Replace [LINUX_USER_NAME] and [APP_NAME]
        alias /home/[LINUX_USER_NAME]/[APP_NAME]/static/;
        expires 30d; # Cache static assets in the browser for 30 days
    }

    # --- Dynamic Content Proxy ---
    # Proxy all other requests (the actual Python application logic) to Gunicorn
    location / {
        # The path to the Gunicorn Unix socket
        include proxy_params;
        proxy_pass http://unix:/tmp/[APP_NAME].sock;
    }
}
